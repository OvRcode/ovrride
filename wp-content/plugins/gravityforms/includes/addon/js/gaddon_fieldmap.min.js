var gfieldmap=function(a){return self.options=a,self.UI=jQuery("#gaddon-setting-row-"+self.options.fieldName),self.init=function(){self.bindEvents(),self.setupData(),self.setupRepeater()},self.bindEvents=function(){self.UI.on("change",'select[name="_gaddon_setting_'+self.options.keyFieldName+'"]',function(){var a=jQuery(this),b=a.next(".custom-key-container");"gf_custom"==a.val()&&a.fadeOut(function(){b.fadeIn().focus()})}),self.UI.on("click","a.custom-key-reset",function(a){a.preventDefault();var b=jQuery(this),c=b.parents(".custom-key-container"),d=c.prev("select.key");c.fadeOut(function(){c.find("input").val("").change(),d.fadeIn().focus().val("")})}),self.UI.closest("form").on("submit",function(a){jQuery('[name^="_gaddon_setting_'+self.options.fieldName+'_"]').each(function(a){jQuery(this).removeAttr("name")})})},self.setupData=function(){self.data=jQuery.parseJSON(jQuery("#"+self.options.fieldId).val()),self.data||(data=[{key:"",value:"",custom_key:""}])},self.setupRepeater=function(){self.UI.find("tbody.repeater").repeater({limit:0,items:self.data,addButtonMarkup:'<img src="'+self.options.baseURL+'/images/add.png" style="cursor:pointer;" />',removeButtonMarkup:'<img src="'+self.options.baseURL+'/images/remove.png" style="cursor:pointer;" />',callbacks:{add:function(a,b,c){var d=b.find('select[name="_gaddon_setting_'+self.options.keyFieldName+'"]');!c.custom_key&&d.length>0?b.find(".custom-key-container").hide():b.find(".key").hide()},save:function(a,b){b=jQuery.extend({},b);for(var c=0;c<b.length;c++)""!=b[c].custom_key&&(b[c].custom=1,b[c].key=b[c].custom_key),delete b[c].custom_key;jQuery("#"+self.options.fieldId).val(jQuery.toJSON(b))}}})},self.init()};