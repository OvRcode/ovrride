global
   log 127.0.0.1  local0
   log 127.0.0.1  local1 notice
   #log loghost   local0 info
   maxconn 4096
   # chroot /usr/share/haproxy
   user haproxy
   group haproxy
   daemon
   stats socket /etc/haproxy/haproxysock level admin
   #debug
   #quiet
   ssl-default-bind-ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA
   
defaults
   log   global
   mode  http
   option   httplog
   option   dontlognull
   retries  3
   option redispatch
   maxconn  2000
   timeout connect  5000
   timeout client  50000
   timeout server  50000

listen HAProxy-Statistics *:25001
    mode http
    option httplog
    option httpclose
    stats enable
    stats uri /
    stats refresh 20s
    stats show-node
    stats show-legends
    stats show-desc Load balancer with SSL Termination
    stats auth admin:ifIruledTheWorld
frontend wordpress
        bind *:<%= node['haproxy']['http_port']%>
        reqadd X-Forwarded-Proto:\ http
        default_backend wordpress-backend

frontend wordpress-ssl
        bind *:<%= node['haproxy']['https_port']%> ssl crt /vagrant/local.ovrride.com.pem no-sslv3
        reqadd X-Forwarded-Proto:\ https
        default_backend wordpress-backend

backend wordpress-backend
    <% node['haproxy']['web_servers'].each do |name, ip| %>
        server <%= name %> <%= ip %>:<%= node['haproxy']['http_port']%> check
    <% end %>